#+TITLE: Org Configuration

The org configuration used to generate this site.
Started from [[https://explog.in/config.org.html][explog]] and tried to customize things a bit.

* Code

# silent results else the adding of results confuses the publisher
#+BEGIN_SRC emacs-lisp :noweb no-export :var fname=(buffer-file-name) :results silent
  (require 'ox-publish)
  (require 'ox-rss)

  ;; Don't do much with the theme. We'll generate the entire theme using
  ;; css from our emacs color scheme. This tells htmlize to use css
  ;; classes to annotate the stuff it would have generated colors for.
  (setq org-html-htmlize-output-type 'css)
  (setq org-export-with-sub-superscripts nil)

  (defun create-preamble (options)
    (concat "<div id='#preamble'><h1><a href='./'>dpzmick.com</a></h1></div>"
            "<div id='bulb' class='need-js' style='display: none'><a href='#/' onclick='switchModes()'><img class='light-invert' src='static/icons/bulb.png' /></a></div>"))

  (defun create-postamble (options)
    (concat
     "<div id='#postamble'><a href='/'>home</a>   "
     "<a href=https://gitlab.com/dpzmick/dpzmick.com/blob/master/"
     (file-relative-name
      (plist-get options :input-file)
      (file-name-directory fname))
     ">view-source</a></div>"))

  (setq header
        (concat
         "<script type='text/javascript' src='/static/scripts.js'></script>"
         "<link rel='stylesheet' type='text/css' href='/static/base.css' />"
         "<link rel='stylesheet' type='text/css' id='theme-css' href='/static/base16-tomorrow-night.css' />"))

  (setq org-publish-project-alist
        `(
          ("dpzmick-notes"
           :base-directory ,(file-name-directory fname)
           :publishing-directory ,(concat (file-name-directory fname) "_site")
           :base-extension "org"
           :recursive t
           :publishing-function org-html-publish-to-html
           :with-author nil
           :section-numbers nil
           :with-toc nil
           :html-validation-link nil
           :html-head-include-scripts nil
           :html-head-include-default-style nil
           :headline-levels 4
           ;; add some custom HTML
           :html-head-extra ,header
           :html-preamble  ,'create-preamble
           :html-postamble ,'create-postamble)

          ("dpzmick-static"
           :base-directory ,(concat (file-name-directory fname) "static")
           :publishing-directory ,(concat
                                   (file-name-as-directory (concat
                                                            (file-name-directory fname)
                                                            "_site"))
                                   "static")
           :base-extension any
           :recursive t
           :publishing-function org-publish-attachment)

          ("dpzmick" :components ("dpzmick-notes"
                                  "dpzmick-static"))))


  (org-publish "dpzmick" t)
#+END_SRC

* FIXME
** TODO RSS feed
** TODO footnotes?
